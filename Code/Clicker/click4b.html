<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Click game (v2.0) created to test the eye tracker accuracy -->
    <style>
        body {
            margin: 0;
        }
        canvas {
            border: 1px solid #d3d3d3;
            background-color: #0d0d0c;
        }
    </style>
</head>

<body onload="startGame()">
    <script>
        var myGamePiece;
        var counter = 0;
        var mx, my;

        function startGame() {
            myGamePiece = new component(15, 720, 325);
            myGameArea.start();
        }

        var myGameArea = {
            canvas: document.createElement("canvas"),
            start: function () {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                this.interval = setInterval(updateGameArea, 20);
                window.addEventListener('mousedown', function (e) {
                    myGameArea.x = e.pageX;
                    myGameArea.y = e.pageY;
                })
                window.addEventListener('mouseup', function (e) {
                    myGameArea.x = false;
                    myGameArea.y = false;
                })
                window.addEventListener('touchstart', function (e) {
                    myGameArea.x = e.pageX;
                    myGameArea.y = e.pageY;
                })
                window.addEventListener('touchend', function (e) {
                    myGameArea.x = false;
                    myGameArea.y = false;
                })
                function getCursorPosition(canvas, event) {
                    const rect = canvas.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;
                    console.log("Mouse coords x: " + x + " y: " + y);
                    mx = x;
                    my = y;
                }
                const canvas = document.querySelector('canvas')
                canvas.addEventListener('mousedown', function(e) {
                    getCursorPosition(canvas, e);
                })
            },
            clear: function () {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            },
            stop: function () {
                clearInterval(this.interval);
            }
        }

        function component(radius, x, y) {
            this.radius = radius;
            this.speedX = 0;
            this.speedY = 0;
            this.x = x;
            this.y = y;
            this.update = function () {
                ctx = myGameArea.context;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'yellow';
                ctx.fill();
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#FFFD33';
                ctx.stroke();
            }
            var base = Date.now();
            var cur;
            this.clicked = function () {
                var clicked = false;
                cur = Date.now();
                console.log(cur-base);
                if (cur-base>100){
                    //console.log (mx + " " + my + " " + this.x + " " + this.y);
                    var xd = (mx-this.x);
                    var xy = (my-this.y);
                    //console.log("XD " + xd + " XY " + xy);
                    var xDist = Math.sqrt((xd*xd)+(xy*xy)); 
                    console.log("DISTANCE " + xDist);
                    var clicked = false;
                    if (xDist<this.radius) clicked = true;
                    base = Date.now();
                    cur = base;
                }
                else{
                    base = Date.now();
                    cur = base;
                }
                return clicked;
            }
        }
        /* moves the target 20 times manually to keep track of where the target is and because JavaScript doesn't have a random seed function*/
        function updateGameArea() {
            myGameArea.clear();
            if (myGameArea.x && myGameArea.y && counter < 20) {
                if (myGamePiece.clicked()==true) {
                    counter++;
                    //console.log(counter);
                    newX = 25+Math.floor(Math.random() * (window.innerWidth-50));
                    newY = 25+Math.floor(Math.random() * (window.innerHeight-50));
                    while(Math.abs(myGamePiece.x-newX)<(window.innerHeight*0.2)){
                        newX = 25+Math.floor(Math.random() * (window.innerWidth-50));
                    }
                    while(Math.abs(myGamePiece.y-newY)<(window.innerWidth*0.2)){
                        newY = 25+Math.floor(Math.random() * (window.innerHeight-50));
                    }
                    myGamePiece.x=newX;
                    myGamePiece.y=newY;
                    console.log("Circle coords x: " + myGamePiece.x + " y: " + myGamePiece.y);
                }
            }
            myGamePiece.update();
            if (counter>= 20){
                myGameArea.clear();
                myGameArea.stop();
            }
        }

    </script>
    <form action="../../index.html">
        <input type="submit" value="Index">
    </form>
</body>

</html>